<!DOCTYPE html>
<html lang="nb">
<head>
    <meta charset="UTF-8">
    <title>Min side</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script src="/JavaScript/lib.js"></script>
    <script src="/JavaScript/libModal.js"></script>
</head>
<body>
<h1>Min side</h1>
<label for="txtUserName">Brukernavn:</label>
<input id="txtUserName">
<button onclick="restChangeUserName().then()">ðŸ”§</button>
<br/>
<label for="txtPassword">Passord:</label>
<input id="txtPassword" type="password">
<br/>
<label for="txtConfirmPassword">Bekreft passord:</label>
<input id="txtConfirmPassword" type="password">
<button onclick="restChangePassword().then()">ðŸ”§</button>
<hr>
<h2>Mine delte lister...</h2>

<script>
    const token = localStorage.getItem("token");
    const fdUserID = localStorage.getItem("fdUserID");

    let txtUserName;
    let txtPassword;
    let txtConfirmPassword;
    let modalWindow = null;

    window.onload = function () {
        txtUserName = document.getElementById("txtUserName");
        txtPassword = document.getElementById("txtPassword");
        txtConfirmPassword = document.getElementById("txtConfirmPassword");
        restGetUserInfo().then();
        modalWindow = new TModalWindow("Dette er en test", EModalState.Normal, EModalButtons.OKCancel);
        modalWindow.showModal(function (aStatus) {
            alert("Bruker klikket pÃ¥ " + aStatus);
        });

    };

    async function restGetUserInfo() {
        const data = {
            token: token,
            fdUserID: fdUserID
        };
        const result = await RestAPI("post", "/users/read", data);
        if (Array.isArray(result) === true) {
            txtUserName.value = result[0].fdUserName;
            txtPassword.value = result[0].fdPassword;
        }
    }

    async function restChangeUserName() {
        const data = {
            token: token,
            fdUserID: fdUserID,
            fdUserName: txtUserName.value
        };
        let result = await RestAPI("post", "/users/updateusername", data);
        if (Array.isArray(result) === false) {
            //  showModalDialog("Brukernavnet er allerede i bruk!", E)
        }
    }

    async function restChangePassword() {
        if (isConfirmPasswordOK() === false) {
            txtConfirmPassword.style.backgroundColor = "red";
            return;
        }
        txtConfirmPassword.style.backgroundColor = "white";
        const data = {
            token: token,
            fdUserID: fdUserID,
            fdPassword: txtPassword.value
        };
        let result = await RestAPI("post", "/users/updatepassword", data);
        if (result !== null) {
            //TODO: obs kan ikke endre passord
        }
    }

    function isConfirmPasswordOK() {
        return txtPassword.value === txtConfirmPassword.value;
    }

</script>
</body>
</html>