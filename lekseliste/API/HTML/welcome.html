<html lang="nb">

<head>
  <title>Lekseliste</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
  <script src="/JavaScript/lib.js"></script>
</head>

<body>
  <h1 onclick="navToToDoList()" style="color: blue; cursor: pointer">LEKSELISTE</h1>
  <p>Welcome</p>
  <div id="divShowTemplate">

  </div>

  <div>
    <span id="txtInfoFromServer"></span>
  </div>

  <template id="templateLogin">
    <fieldset>
      <legend>Login: </legend>
      <label for="txtUserName">Brukernavn: </label>
      <input type="text" id="txtUserName" name="fdUserName">
      <br />
      <label for="txtPassword">Passord: </label>
      <input type="password" id="txtPassword" name="fdPassword">
      <br />
      <button onclick="restLogin().then()">Login</button>
    </fieldset>
  </template>
  <template id="templateLogout">
    <button onclick="logout()">Logg ut</button>
  </template>

  <!-- Programmerer på klientsiden JavaScript-->
<script>
  //global DOM (document object model) elementer
  let txtUserName;
  let txtPassword;
  let txtInfoFromServer;
  let formGetHtmlPage;

  const token = localStorage.getItem('token');
  const fdUserID = localStorage.getItem('fdUserID');

  //Venter til hele nettsiden er lastet slik at alle elementer er på plass
  window.onload = function (){
      //henter felter fra HTML (DOM)
      txtInfoFromServer = document.getElementById("txtInfoFromServer");
      formGetHtmlPage = document.getElementById("formGetHtmlPage");

      if((token) && (fdUserID)){
        const c = getTemplateContent("templateLogout");
        showContent(c,"divShowTemplate");

      }else{
        const c = getTemplateContent("templateLogin");
        showContent(c,"divShowTemplate");
        txtUserName = document.getElementById("txtUserName");
        txtPassword = document.getElementById("txtPassword");
        txtPassword.addEventListener("keydown", enterKeyPressed, false);
      }
  };

  async function restLogin() {
    let data = {
      fdUserName: txtUserName.value,
      fdPassword: txtPassword.value
    };
    const json = await RestAPI("POST","/login",data);
    if(json !== null){
      localStorage.setItem('token',json.token);
      localStorage.setItem('fdUserID', json.fdUserID);
      formLoadPage("/todolist",
        {token: json.token, fdUserID: json.fdUserID}
      );
    }
  }

  function logout(){
    localStorage.removeItem('token');
    localStorage.removeItem('fdUserID');
    location.reload();
  }

  function navToToDoList(){
    formLoadPage("/todolist",
      {token: token, fdUserID: fdUserID}
    );
  }

  function enterKeyPressed(evt) {
    evt = evt || window.event;
    if (evt.key === "Enter") {
      restLogin().then();
    }
  }

</script>

</body>

</html>